import{_ as s,o as n,c as a,U as l}from"./chunks/framework.df9742f3.js";const o="/vue-docs/assets/render.7d40ec4c.png",d=JSON.parse('{"title":"源码目录结构","description":"","frontmatter":{},"headers":[],"relativePath":"blogs/prepare/structure.md","filePath":"blogs/prepare/structure.md","lastUpdated":1702202902000}'),p={name:"blogs/prepare/structure.md"},e=l(`<h1 id="源码目录结构" tabindex="-1">源码目录结构 <a class="header-anchor" href="#源码目录结构" aria-label="Permalink to &quot;源码目录结构&quot;">​</a></h1><p>在正式看源码之前，我们可以先来了解一下整个 Vue3 源码的架构，以及用到了哪些工具</p><h2 id="目录结构" tabindex="-1">目录结构 <a class="header-anchor" href="#目录结构" aria-label="Permalink to &quot;目录结构&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>我们可以在需要查看目录结构的目录下执行<code>tree -aI &quot;.git*|.vscode&quot; -C -L 1</code>就能看到这个目录的整体结构。</p></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">├── </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">circleci </span><span style="color:#676E95;font-style:italic;">// CI 配置目录</span></span>
<span class="line"><span style="color:#A6ACCD;">├── </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ls</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">lint</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">yml </span><span style="color:#676E95;font-style:italic;">// 文件命名规范</span></span>
<span class="line"><span style="color:#A6ACCD;">├── </span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prettierrc </span><span style="color:#676E95;font-style:italic;">// 代码格式化 prettier 的配置文件</span></span>
<span class="line"><span style="color:#A6ACCD;">├── CHANGELOG</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">md  </span><span style="color:#676E95;font-style:italic;">// 更新日志</span></span>
<span class="line"><span style="color:#A6ACCD;">├── LICENSE</span></span>
<span class="line"><span style="color:#A6ACCD;">├── README</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">md</span></span>
<span class="line"><span style="color:#A6ACCD;">├── api</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">extractor</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json </span><span style="color:#676E95;font-style:italic;">// TypeScript 的API提取和分析工具</span></span>
<span class="line"><span style="color:#A6ACCD;">├── jest</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js  </span><span style="color:#676E95;font-style:italic;">//  测试框架 jest 的配置文件</span></span>
<span class="line"><span style="color:#A6ACCD;">├── node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">├── </span><span style="color:#89DDFF;font-style:italic;">package</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">lock</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json</span></span>
<span class="line"><span style="color:#A6ACCD;">├── package</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json</span></span>
<span class="line"><span style="color:#A6ACCD;">├── packages </span><span style="color:#676E95;font-style:italic;">// Vue源代码目录</span></span>
<span class="line"><span style="color:#A6ACCD;">├── rollup</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js  </span><span style="color:#676E95;font-style:italic;">// 模块打包器 rollup 的配置文件</span></span>
<span class="line"><span style="color:#A6ACCD;">├── scripts </span><span style="color:#676E95;font-style:italic;">// 一些命令脚本</span></span>
<span class="line"><span style="color:#A6ACCD;">├── test</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">dts </span><span style="color:#676E95;font-style:italic;">// TypeScript 声明文件</span></span>
<span class="line"><span style="color:#A6ACCD;">├── tsconfig</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">json </span><span style="color:#676E95;font-style:italic;">// TypeScript 配置文件</span></span>
<span class="line"><span style="color:#A6ACCD;">└── yarn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lock</span></span></code></pre></div><p>以上是<code>vue</code>的根目录结构，<code>Vue3</code>采用了<code>monorepo</code>的方式来对项目代码进行管理。我们需要关注的源码都位于<code>packages</code>目录下</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">├── compiler</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">core </span><span style="color:#676E95;font-style:italic;">// 模版编译的核心部分，将我们的模版编译成render函数</span></span>
<span class="line"><span style="color:#A6ACCD;">├── compiler</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">dom </span><span style="color:#676E95;font-style:italic;">// dom中的实现</span></span>
<span class="line"><span style="color:#A6ACCD;">├── compiler</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">sfc </span><span style="color:#676E95;font-style:italic;">// (.vue)单文件组件编译实现</span></span>
<span class="line"><span style="color:#A6ACCD;">├── compiler</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">ssr </span><span style="color:#676E95;font-style:italic;">// 服务端渲染相关</span></span>
<span class="line"><span style="color:#A6ACCD;">├── dts</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">built</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">test</span></span>
<span class="line"><span style="color:#A6ACCD;">├── dts</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">test</span></span>
<span class="line"><span style="color:#A6ACCD;">├── global</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">d</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ts</span></span>
<span class="line"><span style="color:#A6ACCD;">├── reactivity </span><span style="color:#676E95;font-style:italic;">// 响应式核心</span></span>
<span class="line"><span style="color:#A6ACCD;">├── reactivity</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">transform</span></span>
<span class="line"><span style="color:#A6ACCD;">├── runtime</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">core </span><span style="color:#676E95;font-style:italic;">// 运行时核心文件。可以是跨平台的</span></span>
<span class="line"><span style="color:#A6ACCD;">├── runtime</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">dom </span><span style="color:#676E95;font-style:italic;">// web运行环境的实现</span></span>
<span class="line"><span style="color:#A6ACCD;">├── runtime</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">test</span></span>
<span class="line"><span style="color:#A6ACCD;">├── server</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">renderer </span><span style="color:#676E95;font-style:italic;">// 服务端渲染相关</span></span>
<span class="line"><span style="color:#A6ACCD;">├── sfc</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">playground </span><span style="color:#676E95;font-style:italic;">// vue3在线网页</span></span>
<span class="line"><span style="color:#A6ACCD;">├── shared </span><span style="color:#676E95;font-style:italic;">// 共享变量</span></span>
<span class="line"><span style="color:#A6ACCD;">├── template</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">explorer</span></span>
<span class="line"><span style="color:#A6ACCD;">├── vue </span><span style="color:#676E95;font-style:italic;">// vue主入口</span></span>
<span class="line"><span style="color:#A6ACCD;">└── vue</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">compat</span></span></code></pre></div><p>上述是<code>packages</code>的主要目录，每一部分的职责都非常的明显，我们主要关心的如下几个模块</p><ul><li>compiler-core</li><li>compiler-dom</li><li>runtime-core</li><li>runtime-dom</li><li>reactivity</li><li>vue</li></ul><h2 id="vue运行原理" tabindex="-1">vue运行原理 <a class="header-anchor" href="#vue运行原理" aria-label="Permalink to &quot;vue运行原理&quot;">​</a></h2><p>首先我们先大概了解下<code>vue</code>的运行原理，从而更好的知道上述几个模块的作用和他们是如何配合的。我们忽略一些细枝末节的地方，<code>vue</code>的挂载可以拆解为如下几个部分：</p><ol><li>将编写好的 <strong>template模板</strong>，转换为<strong>AST</strong>（compile parse）</li><li>将 <strong>AST</strong> 转换为<strong>JS AST</strong>（compile transferm）</li><li>将<strong>JS AST</strong>转换为<strong>render函数</strong> （compile generate）</li><li>执行<strong>render函数</strong>，生成vnode树，并将页面渲染的副作用函数添加到我们在<code>render</code>过程中访问到的响应式变量的依赖中去</li><li>经过<strong>patch</strong>处理，将<strong>dom结构</strong>呈现在页面上</li><li>当响应式依赖变化的时候执行对应的副作用函数</li></ol><p>在源码执行的时候，我们实例上挂载的<code>render</code>函数就是连接<code>compiler</code>和<code>runtime</code>的桥梁。<code>compiler</code>模块将我们的模版编译成<code>render</code>函数。<code>runtime</code>部分：组件挂载的时候运行<code>render</code>函数生成<code>vnode</code>（虚拟dom），运行<code>render</code>函数的时候会访问到我们的响应式变量，这时候就会将页面渲染的副作用函数添加到依赖中去，最后通过<code>patch</code>函数将虚拟dom生成真实dom挂载在页面上。整个流程如下入所示</p><p><img src="`+o+`" alt="Alt text"></p><h2 id="模块关系图" tabindex="-1">模块关系图 <a class="header-anchor" href="#模块关系图" aria-label="Permalink to &quot;模块关系图&quot;">​</a></h2><p>通过上述分析我们可以知道这几个模块的依赖关系以及是如何运转的了。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">模块关系图</span></span>
<span class="line"><span style="color:#A6ACCD;">                      </span><span style="color:#FFCB6B;">+---------------------+</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">+----------------------+</span></span>
<span class="line"><span style="color:#A6ACCD;">                      </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">                     </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">                      </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">+------------&gt;</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">@vue/compiler-dom</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">+--</span><span style="color:#A6ACCD;">-</span><span style="color:#89DDFF;">&gt;|</span><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">@vue/compiler-core</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">             </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">                     </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">                      </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">+----+----+</span><span style="color:#A6ACCD;">        </span><span style="color:#C3E88D;">+---------------------+</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">+----------------------+</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">                                             </span><span style="color:#FFCB6B;">+</span><span style="color:#A6ACCD;">																					</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">vue</span><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">			                                   </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">         </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">											   </span><span style="color:#FFCB6B;">+</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">+----+----+</span><span style="color:#A6ACCD;">        </span><span style="color:#C3E88D;">+---------------------+</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">+----------------------+</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">+-------------------+</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">             </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">                     </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">                      </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">                   </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">+------------&gt;</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">@vue/runtime-dom</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">+--</span><span style="color:#A6ACCD;">-</span><span style="color:#89DDFF;">&gt;|</span><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">@vue/runtime-core</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">+--</span><span style="color:#A6ACCD;">-</span><span style="color:#89DDFF;">&gt;|</span><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">@vue/reactivity</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">                      </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">                     </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">                      </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">                   </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#A6ACCD;">                      </span><span style="color:#FFCB6B;">+---------------------+</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">+----------------------+</span><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">+-------------------+</span></span></code></pre></div>`,17),t=[e];function c(r,C,y,D,A,i){return n(),a("div",null,t)}const u=s(p,[["render",c]]);export{d as __pageData,u as default};
